@page "/product/{id}"
@using OnlineShop_CourseSubmission_CS.Components;
@using OnlineShop_CourseSubmission_CS.Data
@inject DataService DataService
@using OnlineShop_CourseSubmission_CS.Component;

@if (product!=null && product.Rating!=null)
{
	<div class="container">
		<div class="backtoshop">
			<a class="btn btn-secondary" href="/allproducts">Back to Shop</a>
		</div>
		<h2 class="title-section">@product.Title</h2>
		<div class="detail-container">
			<div class="two-column">
					<img class="detail-image" src="@product.Image" alt="@product.Title" />
			</div>
			<div class="two-column">
				<h5>Category: @product.Category</h5>
				<h5>Rate: @product.Rating.Rate</h5>
				<h5>Viewed by @product.Rating.Count People</h5>
				<hr />
				<h4>@product.Price</h4>
				<div>@product.Description</div>
				<div class="card-body d-flex justify-content-between">
					@if (!WishItem.WishList.Contains(product))
					{
						<button class="card-button" title="add to wishlist" @onclick="()=> WishItem.AddToWish(product.Id)">
							<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-clipboard-heart" viewBox="0 0 16 16">
								<path fill-rule="evenodd" d="M5 1.5A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5v1A1.5 1.5 0 0 1 9.5 4h-3A1.5 1.5 0 0 1 5 2.5v-1Zm5 0a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-1Z" />
								<path d="M3 1.5h1v1H3a1 1 0 0 0-1 1V14a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V3.5a1 1 0 0 0-1-1h-1v-1h1a2 2 0 0 1 2 2V14a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V3.5a2 2 0 0 1 2-2Z" />
								<path d="M8 6.982C9.664 5.309 13.825 8.236 8 12 2.175 8.236 6.336 5.31 8 6.982Z" />
							</svg>
						</button>
					}else{
						<button class="card-button removeheart" title="remove from wishlist" @onclick="()=> WishItem.Remove(product.Id)">
							<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-clipboard-heart" viewBox="0 0 16 16">
								<path fill-rule="evenodd" d="M5 1.5A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5v1A1.5 1.5 0 0 1 9.5 4h-3A1.5 1.5 0 0 1 5 2.5v-1Zm5 0a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-1Z" />
								<path d="M3 1.5h1v1H3a1 1 0 0 0-1 1V14a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V3.5a1 1 0 0 0-1-1h-1v-1h1a2 2 0 0 1 2 2V14a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V3.5a2 2 0 0 1 2-2Z" />
								<path d="M8 6.982C9.664 5.309 13.825 8.236 8 12 2.175 8.236 6.336 5.31 8 6.982Z" />
							</svg>
							<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-x-lg remove" viewBox="0 0 16 16">
								<path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z" />
							</svg>
						</button>
						}
					<button class="card-button" title="add to cart" @onclick="()=>ShoppingCart.AddToCart(product.Id)">
						<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-cart-plus" viewBox="0 0 16 16">
							<path d="M9 5.5a.5.5 0 0 0-1 0V7H6.5a.5.5 0 0 0 0 1H8v1.5a.5.5 0 0 0 1 0V8h1.5a.5.5 0 0 0 0-1H9V5.5z" />
							<path d="M.5 1a.5.5 0 0 0 0 1h1.11l.401 1.607 1.498 7.985A.5.5 0 0 0 4 12h1a2 2 0 1 0 0 4 2 2 0 0 0 0-4h7a2 2 0 1 0 0 4 2 2 0 0 0 0-4h1a.5.5 0 0 0 .491-.408l1.5-8A.5.5 0 0 0 14.5 3H2.89l-.405-1.621A.5.5 0 0 0 2 1H.5zm3.915 10L3.102 4h10.796l-1.313 7h-8.17zM6 14a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm7 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0z" />
						</svg>
					</button>
				</div>
			</div>
		</div>
	</div>
}

@code {
	private Products[]? products;

	private Products? product;

	[Parameter]
	public string? id { get; set; }
	//load data and find the product
	protected override async Task OnInitializedAsync()
	{
		products = await DataService.GetAllProducts();
		if (id!=null){
			product = products.FirstOrDefault(p => p.Id == Int32.Parse(id));
		}
	}
}